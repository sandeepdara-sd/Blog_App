{"ast":null,"code":"import React,{useEffect}from'react';import Header from'./components/Header.js';import{Routes,Route,Navigate}from'react-router-dom';import Auth from'./components/Auth.js';import Blogs from'./components/Blogs.js';import UserBlog from'./components/UserBlog.js';import AddBlog from'./components/AddBlog.js';import BlogDetail from'./components/BlogDetail.js';import{useDispatch,useSelector}from'react-redux';import{authActions}from'./store/index.js';import Signup from'./components/Signup.js';import First from'./components/First.js';import UserInfo from'./components/UserInfo.js';import Loading from'./components/Loading.js';// Added\nimport axios from'axios';import{serverURL}from'./helper/Helper.js';// Import the enhanced CSS\nimport'./App.css';// Protected Route Component - Enhanced\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ProtectedRoute=_ref=>{let{children,isLoggedIn,isLoading,isInitialized}=_ref;// Show loading while checking authentication\nif(isLoading||!isInitialized){return/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:'center',alignItems:'center',minHeight:'60vh'},children:/*#__PURE__*/_jsx(Loading,{message:\"Checking authentication...\"})});}// Redirect to First.js only if we're sure user is not logged in\nif(!isLoggedIn){return/*#__PURE__*/_jsx(Navigate,{to:\"/\",replace:true});}return children;};const App=()=>{const dispatch=useDispatch();const{isLoggedIn,isLoading,isInitialized}=useSelector(state=>({// Updated\nisLoggedIn:state.isLoggedIn,isLoading:state.isLoading,isInitialized:state.isInitialized}));useEffect(()=>{// Updated\nconst checkAuthStatus=async()=>{try{const userId=localStorage.getItem(\"userId\");if(userId){// Set loading state\ndispatch(authActions.setLoading(true));// Fetch complete user data from backend\ntry{const response=await axios.get(\"\".concat(serverURL,\"/api/user/\").concat(userId));const userData=response.data.user;dispatch(authActions.login(userData));}catch(error){console.error('Error fetching user data:',error);// If we can't fetch user data, still allow login with just the ID\ndispatch(authActions.login({_id:userId}));}}else{// No user ID found, mark as not logged in\ndispatch(authActions.setLoading(false));dispatch(authActions.setInitialized(true));}}catch(error){console.error('Error checking auth status:',error);// On error, clear auth and mark as initialized\nlocalStorage.removeItem(\"userId\");dispatch(authActions.logout());}};checkAuthStatus();},[dispatch]);return/*#__PURE__*/_jsxs(\"div\",{className:\"app\",children:[/*#__PURE__*/_jsx(Header,{}),/*#__PURE__*/_jsx(\"main\",{className:\"main-content\",style:{marginTop:'80px'},children:/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",element:isInitialized&&isLoggedIn?/*#__PURE__*/_jsx(Navigate,{to:\"/blogs\",replace:true}):/*#__PURE__*/_jsx(First,{})}),/*#__PURE__*/_jsx(Route,{path:\"/auth\",element:isInitialized&&isLoggedIn?/*#__PURE__*/_jsx(Navigate,{to:\"/blogs\",replace:true}):/*#__PURE__*/_jsx(Auth,{})}),/*#__PURE__*/_jsx(Route,{path:\"/signup\",element:isInitialized&&isLoggedIn?/*#__PURE__*/_jsx(Navigate,{to:\"/blogs\",replace:true}):/*#__PURE__*/_jsx(Signup,{})}),/*#__PURE__*/_jsx(Route,{path:\"/blogs\",element:/*#__PURE__*/_jsx(ProtectedRoute,{isLoggedIn:isLoggedIn,isLoading:isLoading,isInitialized:isInitialized,children:/*#__PURE__*/_jsx(Blogs,{})})}),/*#__PURE__*/_jsx(Route,{path:\"/blogs/add\",element:/*#__PURE__*/_jsx(ProtectedRoute,{isLoggedIn:isLoggedIn,isLoading:isLoading,isInitialized:isInitialized,children:/*#__PURE__*/_jsx(AddBlog,{})})}),/*#__PURE__*/_jsx(Route,{path:\"/myBlogs\",element:/*#__PURE__*/_jsx(ProtectedRoute,{isLoggedIn:isLoggedIn,isLoading:isLoading,isInitialized:isInitialized,children:/*#__PURE__*/_jsx(UserBlog,{})})}),/*#__PURE__*/_jsx(Route,{path:\"/myBlogs/:id\",element:/*#__PURE__*/_jsx(ProtectedRoute,{isLoggedIn:isLoggedIn,isLoading:isLoading,isInitialized:isInitialized,children:/*#__PURE__*/_jsx(BlogDetail,{})})}),/*#__PURE__*/_jsx(Route,{path:\"/user-details/:id\",element:/*#__PURE__*/_jsx(ProtectedRoute,{isLoggedIn:isLoggedIn,isLoading:isLoading,isInitialized:isInitialized,children:/*#__PURE__*/_jsx(UserInfo,{})})}),/*#__PURE__*/_jsx(Route,{path:\"*\",element:isInitialized&&!isLoggedIn?/*#__PURE__*/_jsx(Navigate,{to:\"/\",replace:true}):/*#__PURE__*/_jsx(First,{})})]})})]});};export default App;","map":{"version":3,"names":["React","useEffect","Header","Routes","Route","Navigate","Auth","Blogs","UserBlog","AddBlog","BlogDetail","useDispatch","useSelector","authActions","Signup","First","UserInfo","Loading","axios","serverURL","jsx","_jsx","jsxs","_jsxs","ProtectedRoute","_ref","children","isLoggedIn","isLoading","isInitialized","style","display","justifyContent","alignItems","minHeight","message","to","replace","App","dispatch","state","checkAuthStatus","userId","localStorage","getItem","setLoading","response","get","concat","userData","data","user","login","error","console","_id","setInitialized","removeItem","logout","className","marginTop","path","element"],"sources":["D:/updated_blog/Blog_App/frontend/src/App.js"],"sourcesContent":["import React, { useEffect } from 'react'\nimport Header from './components/Header.js'\nimport {Routes,Route, Navigate} from 'react-router-dom'\nimport Auth from './components/Auth.js'\nimport Blogs from './components/Blogs.js'\nimport UserBlog from './components/UserBlog.js'\nimport AddBlog from './components/AddBlog.js'\nimport BlogDetail from './components/BlogDetail.js'\n\nimport {useDispatch, useSelector} from 'react-redux'\nimport { authActions } from './store/index.js'\nimport Signup from './components/Signup.js'\nimport First from './components/First.js'\nimport UserInfo from './components/UserInfo.js'\nimport Loading from './components/Loading.js' // Added\nimport axios from 'axios'\nimport { serverURL } from './helper/Helper.js'\n\n// Import the enhanced CSS\nimport './App.css'\n\n// Protected Route Component - Enhanced\nconst ProtectedRoute = ({ children, isLoggedIn, isLoading, isInitialized }) => {\n  // Show loading while checking authentication\n  if (isLoading || !isInitialized) {\n    return (\n      <div style={{ \n        display: 'flex', \n        justifyContent: 'center', \n        alignItems: 'center', \n        minHeight: '60vh' \n      }}>\n        <Loading message=\"Checking authentication...\" />\n      </div>\n    );\n  }\n  \n  // Redirect to First.js only if we're sure user is not logged in\n  if (!isLoggedIn) {\n    return <Navigate to=\"/\" replace />;\n  }\n  \n  return children;\n};\n\nconst App = () => {\n  const dispatch = useDispatch()\n  const { isLoggedIn, isLoading, isInitialized } = useSelector(state => ({ // Updated\n    isLoggedIn: state.isLoggedIn,\n    isLoading: state.isLoading,\n    isInitialized: state.isInitialized\n  }))\n  \n  useEffect(() => { // Updated\n    const checkAuthStatus = async () => {\n      try {\n        const userId = localStorage.getItem(\"userId\");\n        if (userId) {\n          // Set loading state\n          dispatch(authActions.setLoading(true));\n          \n          // Fetch complete user data from backend\n          try {\n            const response = await axios.get(`${serverURL}/api/user/${userId}`);\n            const userData = response.data.user;\n            dispatch(authActions.login(userData));\n          } catch (error) {\n            console.error('Error fetching user data:', error);\n            // If we can't fetch user data, still allow login with just the ID\n            dispatch(authActions.login({ _id: userId }));\n          }\n        } else {\n          // No user ID found, mark as not logged in\n          dispatch(authActions.setLoading(false));\n          dispatch(authActions.setInitialized(true));\n        }\n      } catch (error) {\n        console.error('Error checking auth status:', error);\n        // On error, clear auth and mark as initialized\n        localStorage.removeItem(\"userId\");\n        dispatch(authActions.logout());\n      }\n    };\n\n    checkAuthStatus();\n  }, [dispatch]);\n  \n  return (\n    <div className=\"app\">\n      <Header/>\n      <main className=\"main-content\" style={{ marginTop: '80px' }}>\n        <Routes>\n          {/* Public Routes - Always accessible */}\n          <Route path='/' element={\n            isInitialized && isLoggedIn ? <Navigate to=\"/blogs\" replace /> : <First/>\n          } />\n          <Route \n            path='/auth' \n            element={isInitialized && isLoggedIn ? <Navigate to=\"/blogs\" replace /> : <Auth/>} \n          />\n          <Route \n            path='/signup' \n            element={isInitialized && isLoggedIn ? <Navigate to=\"/blogs\" replace /> : <Signup/>} \n          />\n          \n          {/* Protected Routes - Enhanced protection */}\n          <Route path='/blogs' element={\n            <ProtectedRoute isLoggedIn={isLoggedIn} isLoading={isLoading} isInitialized={isInitialized}>\n              <Blogs/>\n            </ProtectedRoute>\n          } />\n          <Route path='/blogs/add' element={\n            <ProtectedRoute isLoggedIn={isLoggedIn} isLoading={isLoading} isInitialized={isInitialized}>\n              <AddBlog/>\n            </ProtectedRoute>\n          } />\n          <Route path='/myBlogs' element={\n            <ProtectedRoute isLoggedIn={isLoggedIn} isLoading={isLoading} isInitialized={isInitialized}>\n              <UserBlog/>\n            </ProtectedRoute>\n          } />\n          <Route path='/myBlogs/:id' element={\n            <ProtectedRoute isLoggedIn={isLoggedIn} isLoading={isLoading} isInitialized={isInitialized}>\n              <BlogDetail/>\n            </ProtectedRoute>\n          } />\n          <Route path=\"/user-details/:id\" element={\n            <ProtectedRoute isLoggedIn={isLoggedIn} isLoading={isLoading} isInitialized={isInitialized}>\n              <UserInfo />\n            </ProtectedRoute>\n          } />\n          \n          {/* Fallback Route - Only redirect if we're sure user is not logged in */}\n          <Route path=\"*\" element={\n            isInitialized && !isLoggedIn ? <Navigate to=\"/\" replace /> : <First/>\n          } />\n        </Routes>\n      </main>\n    </div>\n  )\n}\n\nexport default App\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}